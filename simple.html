<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Grammar</title>
    <style>

/* Rail track styling for connections */
:root {
  /* Default sizing configuration - Medium preset */
  --rail-grid-size: 16px;
  --rail-font-size: 14px;
  --rail-track-width: 6px;
  --rail-text-border: 3px;
  /* Corner radii for textboxes */
  --rail-terminal-radius: calc(var(--rail-grid-size) * 0.9);
  --rail-nonterminal-radius: calc(var(--rail-grid-size) * 0.6);
}

.rail-track {
    fill: none; /* Prevent filling of the path */
    stroke: #000;
    stroke-width: var(--rail-track-width);
    stroke-linecap: butt; /* End exactly at coordinates, don't extend beyond */
}

/* Terminal styling for start/end points */
.start-terminal,
.end-terminal {
    fill: black;
    stroke: none;
}

.highlight {
    stroke: red;
}

/* Terminal and non-terminal text box styling */
.textbox {
    stroke-width: var(--rail-text-border);
    stroke: black;
    fill: none;
}

.textbox.terminal {
    fill: rgb(200, 200, 200);
}

.textbox.nonterminal {
    fill: rgb(210, 210, 210);
}

.textbox-text {
    font-family: Arial, sans-serif;
    font-size: var(--rail-font-size);
    fill: black;
    text-anchor: "middle";    
    dominant-baseline: "middle";
    alignment-baseline: "middle";
}

.textbox-text.nonterminal {
    text-decoration: underline; /* Underline non-terminals */
    cursor: pointer; /* Show it's clickable */
    pointer-events: auto; /* Ensure text can receive click events */
}

.textbox-text.nonterminal:hover {
    fill: #0066cc; /* Blue on hover */
}

/* CSS-based debug visualization using HTML overlays */
.debug-overlay {
    position: absolute !important;
    top: 0 !important;
    left: 0 !important;
    width: 100% !important;
    height: 100% !important;
    pointer-events: none !important;
    z-index: 10 !important;
}

.debug-box-overlay {
    position: absolute !important;
    border: 1px dotted hotpink !important;    
    box-sizing: border-box !important;
    pointer-events: none !important;
}

.debug-baseline-overlay {
    position: absolute !important;
    border-top: 1px dashed hotpink !important;
    pointer-events: none !important;
}

/* Ensure container has relative positioning for debug overlay */
.diagram-container {
    position: relative;
    margin-top: 1rem;
}

/* Fallback: Old SVG-based debug styles (in case CSS approach doesn't work) */
.debug-box {
    stroke: hotpink;    
    stroke-width: 1px;
    stroke-dasharray:6 4;
    fill: none;
}

.debug-baseline {
    stroke: hotpink;    
    stroke-width: 1px;
    stroke-dasharray: 1 1;
    fill: none;
}

/* New syntax rule layout styles */
.syntax-rule {
    margin: 2rem 0;
    padding: 1rem;
    border: 1px solid #ddd;
    border-radius: 8px;
    background-color: #fafafa;
}

.syntax-rule h2 {
    margin: 0 0 1rem 0;
    color: #333;
    font-size: 1.2rem;
}



.error {
    color: red;
    font-weight: bold;
    padding: 1rem;
    background-color: #ffe6e6;
    border: 1px solid red;
    border-radius: 4px;
}

    </style>
</head>
<body>
    <h1>Test Grammar</h1>
    
    <div class="syntax-rule" id="syntax-rule-expression">
        <h2>expression</h2>
        <p><code>expression := term [&quot;+&quot; expression]</code></p>
        <div class="diagram-container">
            <svg width="448" height="64" viewBox="0 0 448 64"><circle cx="16" cy="32" r="14.4" class="start-endpoint"/><g transform="translate(32, 16)" class="main-expression" data-rule="expression"><g transform="translate(0, 0)" class="sequence-child" data-index="0"><g class="textbox-expression" data-type="nonterminal" data-text="term"><rect x="0" y="0" width="96" height="32" rx="9.6" class="textbox nonterminal"/><text x="48" y="16" text-anchor="middle" dominant-baseline="middle" class="textbox-text nonterminal">term</text><path d="M -16 16 L 0 16" class="rail-track" data-id="textbox-left" data-seq="start(-1, 1, east) forward(1)"/><path d="M -16 16 L 0 16" class="rail-track" data-id="textbox-left" data-seq="start(-1, 1, east) forward(1)"/><path d="M 96 16 L 112 16" class="rail-track" data-id="textbox-right" data-seq="start(6, 1, east) forward(1)"/><path d="M 96 16 L 112 16" class="rail-track" data-id="textbox-right" data-seq="start(6, 1, east) forward(1)"/></g></g><path d="M 96 16 L 128 16" class="rail-track" data-id="seq-0" data-seq="start(6, 1, east) forward(2)"/><g transform="translate(128, 0)" class="sequence-child" data-index="1"><g class="textbox-expression" data-type="nonterminal" data-text="[&quot;+&quot;"><rect x="0" y="0" width="96" height="32" rx="9.6" class="textbox nonterminal"/><text x="48" y="16" text-anchor="middle" dominant-baseline="middle" class="textbox-text nonterminal">[&quot;+&quot;</text><path d="M -16 16 L 0 16" class="rail-track" data-id="textbox-left" data-seq="start(-1, 1, east) forward(1)"/><path d="M -16 16 L 0 16" class="rail-track" data-id="textbox-left" data-seq="start(-1, 1, east) forward(1)"/><path d="M 96 16 L 112 16" class="rail-track" data-id="textbox-right" data-seq="start(6, 1, east) forward(1)"/><path d="M 96 16 L 112 16" class="rail-track" data-id="textbox-right" data-seq="start(6, 1, east) forward(1)"/></g></g><path d="M 224 16 L 256 16" class="rail-track" data-id="seq-1" data-seq="start(14, 1, east) forward(2)"/><g transform="translate(256, 0)" class="sequence-child" data-index="2"><g class="textbox-expression" data-type="nonterminal" data-text="expression]"><rect x="0" y="0" width="128" height="32" rx="9.6" class="textbox nonterminal"/><text x="64" y="16" text-anchor="middle" dominant-baseline="middle" class="textbox-text nonterminal">expression]</text><path d="M -16 16 L 0 16" class="rail-track" data-id="textbox-left" data-seq="start(-1, 1, east) forward(1)"/><path d="M -16 16 L 0 16" class="rail-track" data-id="textbox-left" data-seq="start(-1, 1, east) forward(1)"/><path d="M 128 16 L 144 16" class="rail-track" data-id="textbox-right" data-seq="start(8, 1, east) forward(1)"/><path d="M 128 16 L 144 16" class="rail-track" data-id="textbox-right" data-seq="start(8, 1, east) forward(1)"/></g></g></g><circle cx="432" cy="32" r="14.4" class="end-endpoint"/><path d="M 20 32 L 32 32" class="rail-track" data-id="start-connection" data-seq="start(1.25, 2, east) forward(0.75)"/><path d="M 416 32 L 428 32" class="rail-track" data-id="end-connection" data-seq="start(26, 2, east) forward(0.75)"/></svg>
        </div>
    </div>
    <div class="syntax-rule" id="syntax-rule-term">
        <h2>term</h2>
        <p><code>term := factor [&quot;*&quot; term]</code></p>
        <div class="diagram-container">
            <svg width="416" height="64" viewBox="0 0 416 64"><circle cx="16" cy="32" r="14.4" class="start-endpoint"/><g transform="translate(32, 16)" class="main-expression" data-rule="term"><g transform="translate(0, 0)" class="sequence-child" data-index="0"><g class="textbox-expression" data-type="nonterminal" data-text="factor"><rect x="0" y="0" width="96" height="32" rx="9.6" class="textbox nonterminal"/><text x="48" y="16" text-anchor="middle" dominant-baseline="middle" class="textbox-text nonterminal">factor</text><path d="M -16 16 L 0 16" class="rail-track" data-id="textbox-left" data-seq="start(-1, 1, east) forward(1)"/><path d="M -16 16 L 0 16" class="rail-track" data-id="textbox-left" data-seq="start(-1, 1, east) forward(1)"/><path d="M 96 16 L 112 16" class="rail-track" data-id="textbox-right" data-seq="start(6, 1, east) forward(1)"/><path d="M 96 16 L 112 16" class="rail-track" data-id="textbox-right" data-seq="start(6, 1, east) forward(1)"/></g></g><path d="M 96 16 L 128 16" class="rail-track" data-id="seq-0" data-seq="start(6, 1, east) forward(2)"/><g transform="translate(128, 0)" class="sequence-child" data-index="1"><g class="textbox-expression" data-type="nonterminal" data-text="[&quot;*&quot;"><rect x="0" y="0" width="96" height="32" rx="9.6" class="textbox nonterminal"/><text x="48" y="16" text-anchor="middle" dominant-baseline="middle" class="textbox-text nonterminal">[&quot;*&quot;</text><path d="M -16 16 L 0 16" class="rail-track" data-id="textbox-left" data-seq="start(-1, 1, east) forward(1)"/><path d="M -16 16 L 0 16" class="rail-track" data-id="textbox-left" data-seq="start(-1, 1, east) forward(1)"/><path d="M 96 16 L 112 16" class="rail-track" data-id="textbox-right" data-seq="start(6, 1, east) forward(1)"/><path d="M 96 16 L 112 16" class="rail-track" data-id="textbox-right" data-seq="start(6, 1, east) forward(1)"/></g></g><path d="M 224 16 L 256 16" class="rail-track" data-id="seq-1" data-seq="start(14, 1, east) forward(2)"/><g transform="translate(256, 0)" class="sequence-child" data-index="2"><g class="textbox-expression" data-type="nonterminal" data-text="term]"><rect x="0" y="0" width="96" height="32" rx="9.6" class="textbox nonterminal"/><text x="48" y="16" text-anchor="middle" dominant-baseline="middle" class="textbox-text nonterminal">term]</text><path d="M -16 16 L 0 16" class="rail-track" data-id="textbox-left" data-seq="start(-1, 1, east) forward(1)"/><path d="M -16 16 L 0 16" class="rail-track" data-id="textbox-left" data-seq="start(-1, 1, east) forward(1)"/><path d="M 96 16 L 112 16" class="rail-track" data-id="textbox-right" data-seq="start(6, 1, east) forward(1)"/><path d="M 96 16 L 112 16" class="rail-track" data-id="textbox-right" data-seq="start(6, 1, east) forward(1)"/></g></g></g><circle cx="400" cy="32" r="14.4" class="end-endpoint"/><path d="M 20 32 L 32 32" class="rail-track" data-id="start-connection" data-seq="start(1.25, 2, east) forward(0.75)"/><path d="M 384 32 L 396 32" class="rail-track" data-id="end-connection" data-seq="start(24, 2, east) forward(0.75)"/></svg>
        </div>
    </div>
    <div class="syntax-rule" id="syntax-rule-factor">
        <h2>factor</h2>
        <p><code>factor := number / &quot;(&quot; expression &quot;)&quot;</code></p>
        <div class="diagram-container">
            <svg width="448" height="176" viewBox="0 0 448 176"><circle cx="16" cy="80" r="14.4" class="start-endpoint"/><g transform="translate(32, 16)" class="main-expression" data-rule="factor"><g transform="translate(144, 32)" class="stack-child" data-index="0" data-alternative="true"><g class="textbox-expression" data-type="nonterminal" data-text="number"><rect x="0" y="0" width="96" height="32" rx="9.6" class="textbox nonterminal"/><text x="48" y="16" text-anchor="middle" dominant-baseline="middle" class="textbox-text nonterminal">number</text><path d="M -16 16 L 0 16" class="rail-track" data-id="textbox-left" data-seq="start(-1, 1, east) forward(1)"/><path d="M -16 16 L 0 16" class="rail-track" data-id="textbox-left" data-seq="start(-1, 1, east) forward(1)"/><path d="M 96 16 L 112 16" class="rail-track" data-id="textbox-right" data-seq="start(6, 1, east) forward(1)"/><path d="M 96 16 L 112 16" class="rail-track" data-id="textbox-right" data-seq="start(6, 1, east) forward(1)"/></g></g><path d="M 0 64 L 144 64" class="rail-track" data-id="child0-left" data-seq="start(0, 4, east) forward(9)"/><path d="M 240 48 L 384 48" class="rail-track" data-id="child0-right" data-seq="start(15, 3, east) forward(9)"/><g transform="translate(32, 80)" class="stack-child" data-index="1" data-alternative="true"><g transform="translate(0, 0)" class="sequence-child" data-index="0"><g class="textbox-expression" data-type="terminal" data-text="("><rect x="0" y="0" width="64" height="32" rx="9.6" class="textbox terminal"/><text x="32" y="16" text-anchor="middle" dominant-baseline="middle" class="textbox-text terminal">(</text><path d="M -16 16 L 0 16" class="rail-track" data-id="textbox-left" data-seq="start(-1, 1, east) forward(1)"/><path d="M -16 16 L 0 16" class="rail-track" data-id="textbox-left" data-seq="start(-1, 1, east) forward(1)"/><path d="M 64 16 L 80 16" class="rail-track" data-id="textbox-right" data-seq="start(4, 1, east) forward(1)"/><path d="M 64 16 L 80 16" class="rail-track" data-id="textbox-right" data-seq="start(4, 1, east) forward(1)"/></g></g><path d="M 64 16 L 96 16" class="rail-track" data-id="seq-0" data-seq="start(4, 1, east) forward(2)"/><g transform="translate(96, 0)" class="sequence-child" data-index="1"><g class="textbox-expression" data-type="nonterminal" data-text="expression"><rect x="0" y="0" width="128" height="32" rx="9.6" class="textbox nonterminal"/><text x="64" y="16" text-anchor="middle" dominant-baseline="middle" class="textbox-text nonterminal">expression</text><path d="M -16 16 L 0 16" class="rail-track" data-id="textbox-left" data-seq="start(-1, 1, east) forward(1)"/><path d="M -16 16 L 0 16" class="rail-track" data-id="textbox-left" data-seq="start(-1, 1, east) forward(1)"/><path d="M 128 16 L 144 16" class="rail-track" data-id="textbox-right" data-seq="start(8, 1, east) forward(1)"/><path d="M 128 16 L 144 16" class="rail-track" data-id="textbox-right" data-seq="start(8, 1, east) forward(1)"/></g></g><path d="M 224 16 L 256 16" class="rail-track" data-id="seq-1" data-seq="start(14, 1, east) forward(2)"/><g transform="translate(256, 0)" class="sequence-child" data-index="2"><g class="textbox-expression" data-type="terminal" data-text=")"><rect x="0" y="0" width="64" height="32" rx="9.6" class="textbox terminal"/><text x="32" y="16" text-anchor="middle" dominant-baseline="middle" class="textbox-text terminal">)</text><path d="M -16 16 L 0 16" class="rail-track" data-id="textbox-left" data-seq="start(-1, 1, east) forward(1)"/><path d="M -16 16 L 0 16" class="rail-track" data-id="textbox-left" data-seq="start(-1, 1, east) forward(1)"/><path d="M 64 16 L 80 16" class="rail-track" data-id="textbox-right" data-seq="start(4, 1, east) forward(1)"/><path d="M 64 16 L 80 16" class="rail-track" data-id="textbox-right" data-seq="start(4, 1, east) forward(1)"/></g></g></g><path d="M 0 64 A 16 16 0 0 1 16 80 L 16 80 A 16 16 0 0 0 32 96 L 32 96" class="rail-track" data-id="child1-left" data-seq="start(0, 4, east) turnRight() forward(0) turnLeft() forward(0)"/><path d="M 384 64 A 16 16 0 0 0 368 80 L 368 80 A 16 16 0 0 1 352 96 L 352 96" class="rail-track" data-id="child1-right" data-seq="start(24, 4, west) turnLeft() forward(0) turnRight() forward(0)"/></g><circle cx="432" cy="80" r="14.4" class="end-endpoint"/><path d="M 20 80 L 32 80" class="rail-track" data-id="start-connection" data-seq="start(1.25, 5, east) forward(0.75)"/><path d="M 416 80 L 428 80" class="rail-track" data-id="end-connection" data-seq="start(26, 5, east) forward(0.75)"/></svg>
        </div>
    </div>
    <div class="syntax-rule" id="syntax-rule-number">
        <h2>number</h2>
        <p><code>number := 1*DIGIT</code></p>
        <div class="diagram-container">
            <svg width="352" height="80" viewBox="0 0 352 80"><circle cx="16" cy="48" r="14.4" class="start-endpoint"/><g transform="translate(32, 16)" class="main-expression" data-rule="number"><g transform="translate(0, 16)" class="sequence-child" data-index="0"><g class="textbox-expression" data-type="nonterminal" data-text="DIGIT"><rect x="0" y="0" width="96" height="32" rx="9.6" class="textbox nonterminal"/><text x="48" y="16" text-anchor="middle" dominant-baseline="middle" class="textbox-text nonterminal">DIGIT</text><path d="M -16 16 L 0 16" class="rail-track" data-id="textbox-left" data-seq="start(-1, 1, east) forward(1)"/><path d="M -16 16 L 0 16" class="rail-track" data-id="textbox-left" data-seq="start(-1, 1, east) forward(1)"/><path d="M 96 16 L 112 16" class="rail-track" data-id="textbox-right" data-seq="start(6, 1, east) forward(1)"/><path d="M 96 16 L 112 16" class="rail-track" data-id="textbox-right" data-seq="start(6, 1, east) forward(1)"/></g></g><path d="M 96 32 L 128 32" class="rail-track" data-id="seq-0" data-seq="start(6, 2, east) forward(2)"/><g transform="translate(128, 0)" class="sequence-child" data-index="1"><g transform="translate(32, 16)" class="loop-child"><g class="textbox-expression" data-type="nonterminal" data-text="DIGIT"><rect x="0" y="0" width="96" height="32" rx="9.6" class="textbox nonterminal"/><text x="48" y="16" text-anchor="middle" dominant-baseline="middle" class="textbox-text nonterminal">DIGIT</text><path d="M -16 16 L 0 16" class="rail-track" data-id="textbox-left" data-seq="start(-1, 1, east) forward(1)"/><path d="M -16 16 L 0 16" class="rail-track" data-id="textbox-left" data-seq="start(-1, 1, east) forward(1)"/><path d="M 96 16 L 112 16" class="rail-track" data-id="textbox-right" data-seq="start(6, 1, east) forward(1)"/><path d="M 96 16 L 112 16" class="rail-track" data-id="textbox-right" data-seq="start(6, 1, east) forward(1)"/></g></g><path d="M 32 32 A 16 16 0 0 1 16 16 L 16 16 A 16 16 0 0 1 32 0 L 128 0 A 16 16 0 0 1 144 16 L 144 16 A 16 16 0 0 1 128 32" class="rail-track" data-id="loop-path" data-seq="start(2, 2, west) turnRight() forward(0) turnRight() forward(6) turnRight() forward(0) turnRight()"/><path d="M 0 32 L 32 32" class="rail-track" data-id="through-left" data-seq="start(0, 2, east) forward(2)"/><path d="M 160 32 L 128 32" class="rail-track" data-id="through-right" data-seq="start(10, 2, west) forward(2)"/></g></g><circle cx="336" cy="48" r="14.4" class="end-endpoint"/><path d="M 20 48 L 32 48" class="rail-track" data-id="start-connection" data-seq="start(1.25, 3, east) forward(0.75)"/><path d="M 320 48 L 332 48" class="rail-track" data-id="end-connection" data-seq="start(20, 3, east) forward(0.75)"/></svg>
        </div>
    </div>
    <div class="syntax-rule" id="syntax-rule-DIGIT">
        <h2>DIGIT</h2>
        <p><code>DIGIT := %x30-39</code></p>
        <div class="diagram-container">
            <svg width="160" height="64" viewBox="0 0 160 64"><circle cx="16" cy="32" r="14.4" class="start-endpoint"/><g transform="translate(32, 16)" class="main-expression" data-rule="DIGIT"><g class="textbox-expression" data-type="terminal" data-text="%x30-39"><rect x="0" y="0" width="96" height="32" rx="9.6" class="textbox terminal"/><text x="48" y="16" text-anchor="middle" dominant-baseline="middle" class="textbox-text terminal">%x30-39</text><path d="M -16 16 L 0 16" class="rail-track" data-id="textbox-left" data-seq="start(-1, 1, east) forward(1)"/><path d="M -16 16 L 0 16" class="rail-track" data-id="textbox-left" data-seq="start(-1, 1, east) forward(1)"/><path d="M 96 16 L 112 16" class="rail-track" data-id="textbox-right" data-seq="start(6, 1, east) forward(1)"/><path d="M 96 16 L 112 16" class="rail-track" data-id="textbox-right" data-seq="start(6, 1, east) forward(1)"/></g></g><circle cx="144" cy="32" r="14.4" class="end-endpoint"/><path d="M 20 32 L 32 32" class="rail-track" data-id="start-connection" data-seq="start(1.25, 2, east) forward(0.75)"/><path d="M 128 32 L 140 32" class="rail-track" data-id="end-connection" data-seq="start(8, 2, east) forward(0.75)"/></svg>
        </div>
    </div>

    <footer style="margin-top: 2rem; padding: 1rem; border-top: 1px solid #ccc; color: #666;">
        <p>Generated from ABNF grammar using abnf-to-railroad tool</p>
    </footer>

    <script>
        // Add grid pattern to all SVG elements
        function addGridToSVGs() {
            const svgs = document.querySelectorAll('svg');
            const gridSize = 16; // Match the grid size from the renderer
            const patternId = 'grid-pattern'; // Same ID in each SVG
            
            svgs.forEach((svg) => {
                // Create defs element if it doesn't exist, append at end
                let defs = svg.querySelector('defs');
                if (!defs) {
                    defs = document.createElementNS('http://www.w3.org/2000/svg', 'defs');
                    svg.appendChild(defs); // Add at end instead of beginning
                }
                
                // Create pattern element in each SVG's defs
                const pattern = document.createElementNS('http://www.w3.org/2000/svg', 'pattern');
                pattern.setAttribute('id', patternId);
                pattern.setAttribute('patternUnits', 'userSpaceOnUse');
                pattern.setAttribute('width', gridSize);
                pattern.setAttribute('height', gridSize);
                
                // Create thin grid lines
                function createGridLine(x1, y1, x2, y2) {
                    const line = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                    line.setAttribute('x1', x1);
                    line.setAttribute('y1', y1);
                    line.setAttribute('x2', x2);
                    line.setAttribute('y2', y2);
                    line.setAttribute('stroke', 'hotpink');
                    line.setAttribute('stroke-width', '0.5');
                    line.setAttribute('opacity', '0.3');
                    pattern.appendChild(line);
                }

                // Create horizontal lines
                createGridLine(0, 0, 5, 0);
                createGridLine(gridSize-5, 0, gridSize, 0);
                
                // Create vertical line
                createGridLine(0, 0, 0, 5);
                createGridLine(0, gridSize-5, 0, gridSize);
                
             
                defs.appendChild(pattern);
                
                // Create background rectangle and append at end
                const background = document.createElementNS('http://www.w3.org/2000/svg', 'rect');
                background.setAttribute('x', '0');
                background.setAttribute('y', '0');
                background.setAttribute('width', '100%');
                background.setAttribute('height', '100%');
                background.setAttribute('fill', `url(#${patternId})`);
                background.setAttribute('class', 'grid-background');
                
                // Append background at the end of the SVG
                svg.appendChild(background);
            });
        }
        
        // Add grid when DOM is loaded
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', addGridToSVGs);
        } else {
            addGridToSVGs();
        }
        
        // Optional: Add toggle functionality
        document.addEventListener('keydown', function(e) {
            if (e.key === 'g' && e.ctrlKey) {
                e.preventDefault();
                const gridElements = document.querySelectorAll('.grid-background');
                gridElements.forEach(grid => {
                    grid.style.display = grid.style.display === 'none' ? '' : 'none';
                });
            }
        });
    </script>
</body>
</html>